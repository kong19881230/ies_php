window.EasyLogin={};$(function(){EasyLogin.signout=function(e){$.post(EasyLogin.config.ajax_url,{action:"signout"},function(){if(e)window.location.href=e;else window.location.reload()})};var e=function(e,t,n){if(t==0&!n){e.fadeOut();return}e.find("span").html(t);e.removeClass("alert-danger alert-warning alert-success");switch(n){case 1:e.addClass("alert-warning");break;case 2:e.addClass("alert-danger");break;case 3:e.addClass("alert-success");break}e.fadeIn()},t=function(t){var n=function(e){if(t.find('[name="'+e+'"]').length)return t.find('[name="'+e+'"]');return false},r=n("action").val(),i=t.find(".alert"),s,o,u,a;$.fn.tval=function(){return $.trim($(this).val())};switch(r){case"signin":var f=n("username"),l=n("password");if(!f.tval().length)return f.focus();if(!l.tval().length)return l.focus();u=function(e){if(e)window.location.href=e;else window.location.reload()};break;case"signup":var f=n("username"),c=n("email"),h=n("name"),l=n("password"),p=n("recaptcha_response_field");if(f&&!f.tval().length)return f.focus();if(!c.tval().length)return c.focus();if(h&&!h.tval().length)return h.focus();if(!l.tval().length)return l.focus();if(p&&!p.tval().length)return p.focus();u=function(e){$("#EL_signup").modal("hide");if(e)$("#EL_signup_complete1").modal("show");else $("#EL_signup_complete2").modal("show")};break;case"forgot_pass":var c=n("email"),p=n("recaptcha_response_field");if(!c.tval().length)return c.focus();if(p&&!p.tval().length)return p.focus();u=function(){$("#EL_forgot_pass").modal("hide");$("#EL_recover_sent").modal("show")};break;case"resend_activation":var c=n("email"),p=n("recaptcha_response_field");if(!c.tval().length)return c.focus();if(p&&!p.tval().length)return p.focus();u=function(){$("#EL_resend_activation").modal("hide");$("#EL_signup_complete1").modal("show")};break;case"recover_pass":var d=n("password"),v=n("confirm_password");if(!d.tval().length)return d.focus();if(d.val()!=v.val())return e(i,EasyLogin.msgs.pass_not_match,2);u=function(){t.find(".modal-body").html(EasyLogin.msgs.pass_changed);t.find(".modal-footer").remove();window.location.hash=""};break;case"account":var c=n("email"),h=n("name"),m=n("website"),d=n("password"),v=n("confirm_password");if(!c.tval().length&&$("#account_general").hasClass("active"))return c.focus();if(h&&!h.tval().length)return h.focus();if(d.tval().length){if(!d.tval().length)return d.focus();if(d.val()!=v.val())return e(i,EasyLogin.msgs.pass_not_match,2);if(d.tval().length<4||d.tval().length>20)return e(i,EasyLogin.msgs.invalid_password,2)}u=function(t){if(t.pass_changed)e(i,EasyLogin.msgs.pass_changed2,3);else e(i,EasyLogin.msgs.saved,3);d.val("");v.val("");var n=$("#EL_account img.user-avatar").attr("src");$("img.user-avatar").attr("src",n);setTimeout(function(){e(i,0)},5e3)};break}e(i,0);$.ajax({url:EasyLogin.config.ajax_url,type:"POST",dataType:"json",data:{action:r,data:t.serialize()},beforeSend:function(){t.find('[type="submit"]').prop("disabled",true);t.find(".ajax-loader").css("display","inline-block")}}).done(function(t){if(s)return s(t);if(t.success&&u)return u(t.data);if(a)return a(t.data);var n=$("<ul/>"),r=t.data;if(r.length>1)for(var o=0;o<r.length;o++)n.append($("<li/>",{html:EasyLogin.msgs[r[o]]||r[o]}));else n=EasyLogin.msgs[r[0]]||EasyLogin.msgs.error;e(i,n,2)}).fail(function(){if(o)o();else e(i,EasyLogin.msgs.error,2)}).always(function(){t.find('[type="submit"]').prop("disabled",false);t.find(".ajax-loader").hide();if(typeof Recaptcha=="object")Recaptcha.reload()})};$(".close.dismiss").on("click",function(e){$(this).parent().fadeOut(100);e.preventDefault()});$(".easylogin-form").on("submit",function(e){t($(this));e.preventDefault()});$("#EL_signin").on("show.bs.modal",function(){$("[id^=EL_]:not(#EL_signin)").modal("hide")});$("#EL_forgot_pass, #EL_resend_activation").on("show.bs.modal",function(){$("#EL_signin").modal("hide")});$("[id^=EL_]").on("hidden.bs.modal",function(e){$(e.target).find("form").find('input:not([name="action"],[name="avatartype"]), textarea, select').val("");$(e.target).find(".alert").hide()});$("#EL_signup, #EL_forgot_pass, #EL_resend_activation").on("show.bs.modal",function(e){var t=$("#recaptchaTemplate");if(t.length){$(".recaptcha-group").html("");$(e.target).find(".recaptcha-group").html(t.html());$.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){var e=$('[name="recaptcha_public_key"]').val();Recaptcha.create(e,"easylogin_recaptcha",{theme:"custom",custom_theme_widget:"easylogin_recaptcha"})})}});$("#EL_account").on("show.bs.modal",function(e){var t=$(e.target).find("form");t.find('[data-toggle="tab"]').on("click",function(){t.find(".alert").hide();t.find('[name="password"]').val("");t.find('[name="confirm_password"]').val("")});t.find('[name="avatartype"]').on("click",function(e){$.get(EasyLogin.config.ajax_url,{action:"get_avatar",type:$(e.target).val()},function(e){if(e.success)$("#EL_account img.user-avatar").attr("src",e.data)},"json")});$.get(EasyLogin.config.ajax_url,{action:"userdata"},function(e){if(e.success){t.find('[name="email"]').val(e.data.email);t.find('[name="name"]').val(e.data.name);t.find('[name="url"]').val(e.data.url);t.find("#account_settings").html(e.data.custom_fields_html);t.find('[name="avatartype"][value="'+e.data.avatar+'"]').prop("checked",true);t.find("img.user-avatar").attr("src",e.data.avatarUrl)}},"json")});var n=window.location.hash;if(n.substr(1,9)=="activate-"){$.post(EasyLogin.config.ajax_url,{action:"activate_account",activation_key:n.substr(10,n.length)},function(e){if(e.success)$("#EL_account_activated").modal("show");else alert(EasyLogin.msgs[e.data[0]]||EasyLogin.msgs.error);window.location.hash=""},"json")}else if(n.substr(1,8)=="recover-"){var r=n.substr(9,n.length);$.post(EasyLogin.config.ajax_url,{action:"check_recover_key",recover_key:r},function(e){if(e.success){$("#EL_recover_pass").modal("show");$('#EL_recover_pass input[name="recover_key"]').val(r)}else alert(EasyLogin.msgs[e.data[0]]||EasyLogin.msgs.error)},"json")}var i=navigator.userAgent.toLowerCase(),s=false;if(i.indexOf("msie")>=0||i.indexOf("trident/")>=0)s=true;$(".edit-avatar").imgPicker({el:".user-avatar",minWidth:100,minHeight:100,title:"更變您的頭像 / Change your avatar",api:EasyLogin.config.ajax_url,swf_url:EasyLogin.config.script_url+"assets/webcam.swf",complete:function(){$(".easylogin-form").trigger("submit");if(s)$("#EL_account").show()},cancel:function(){if(s)$("#EL_account").show()}}).on("click",function(){$('[name="avatartype"][value="uploaded"]').prop("checked",true).trigger("click");if(s)$("#EL_account").hide()})});EasyLogin.msgs={error:"Unexpected Error.",invalid_credentials:"Invalid credentials !",invalid_name:"Enter a valid name",invalid_username:"Enter a valid username",invalid_email:"Enter a valid email address",invalid_password:"Enter a valid password, minimum 4, maximum 20 characters",invalid_captcha:"Invalid captcha",unique_email:"This email is already registed",unique_username:"This username is already taken",disabled:"Your account is disabled :(",unconfirmed:"Your account is not activated.",no_account:"No account found",invalid_activation_key:"Invalid activation link.",already_activated:"Your account is already activated.",invalid_recover_key:"Invalid recover link",pass_not_match:"Passwords do not mach",pass_changed:'<p>Password successfully changed.</p><p> You can <a href="#" data-toggle="modal" data-target="#EL_signin">sign in</a> now.</p>',pass_changed2:"Password changed.",saved:"Settings saved."}